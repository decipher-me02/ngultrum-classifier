<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <title>Ngultrum Classifier</title>
  <link rel="icon" type="image/png" href="assets/images/logo.png">

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="assets/css/camera.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>

<script>
  function startCamera() {
  const video = document.getElementById("camera-stream");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(function (stream) {
      video.srcObject = stream;

      setInterval(() => {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const base64Image = canvas.toDataURL("image/jpeg").split(",")[1];

        fetch("http://localhost:5000/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ image: base64Image })
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            document.getElementById("processed-frame").src = "data:image/jpeg;base64," + data.boxed_image;
          }
        });

      }, 3000); // send every 3 seconds
    })
    .catch(function (err) {
      console.error("Camera access failed:", err);
    });
}

document.addEventListener("DOMContentLoaded", startCamera);


</script>


<body>

  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <nav class="main-nav">
            <!-- Logo -->
            <a href="index.html" class="logo-link">
                <div class="logo-title-wrapper">
                  <img src="assets/images/logo.png" alt="Logo" class="logo-img">
                  <span class="site-title">NGULTRUM CLASSIFIER</span>
                </div>
              </a>              
          
            <!-- Hamburger Menu -->
            <div class="menu-trigger" id="menu-toggle">
              <span></span>
              <span></span>
              <span></span>
            </div>
          
            <!-- Menu Items -->
            <ul class="nav" id="mobile-nav">
              <li><a href="home.html">Home</a></li>
              <li><a href="about.html">About Us</a></li>
            </ul>
          </nav>             
        </div>
      </div>
    </div>
  </header>
  
  <!-- ***** Header Area End ***** -->

  <!-- ***** Content Section Start ***** -->
  <section class="hero text-center">
    <!-- Inside <section class="hero text-center"> -->
    <h2 class="camera-heading">Your AI Ngultrum classifier!</h2>
   <video id="camera-stream" autoplay playsinline style="display: none;"></video>
    <canvas id="canvas" width="640" height="480" style="display: none;"></canvas>
    <img id="processed-frame" width="640" height="480" alt="Detected Frame" />


  </section>
  
  <!-- Prediction Output -->


  <!-- ***** Content Section End ***** -->

  <!-- ***** Footer Section Start ***** -->
  <footer class="footer-area">
    <div class="container"> 
      <div class="col-lg-12 text-center">
        <p>Â© 2025 Ngultrum Classifier | All rights reserved</p>
      </div>
    </div>
  </footer>
  <!-- ***** Footer Section End ***** -->

  <!-- Scripts -->

  
 <!-- Scripts -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="assets/js/custom.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script>
  lucide.createIcons();
</script>

<script>
  // Responsive Nav Toggle
  document.addEventListener("DOMContentLoaded", function () {
    const menuToggle = document.getElementById("menu-toggle");
    const nav = document.getElementById("mobile-nav");
    menuToggle.addEventListener("click", function () {
      menuToggle.classList.toggle("active");
      nav.classList.toggle("show");
    });
  });
</script>

<script>
  function isMobileOrTablet() {
    return /Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent);
  }

  function startCamera() {
    let constraints;

    if (isMobileOrTablet()) {
      constraints = { video: { facingMode: { exact: "environment" } } };
    } else {
      constraints = { video: { facingMode: "user" } };
    }

    navigator.mediaDevices.getUserMedia(constraints)
      .then(function(stream) {
        const video = document.getElementById('camera-stream');
        video.srcObject = stream;
      })
      .catch(function(error) {
        console.error("Camera access error:", error);
        alert("Unable to access camera.");
      });
  }

  // Real-Time Detection
  function startRealTimeDetection() {
    const video = document.getElementById("camera-stream");
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = 640;
    canvas.height = 480;

    setInterval(() => {
      if (!video.srcObject) return;

      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const dataURL = canvas.toDataURL("image/jpeg");
      const base64Image = dataURL.split(",")[1];

      fetch("http://localhost:5000/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: base64Image })
      })
      .then(res => res.json())
      .then(data => {
        const output = document.getElementById("output-text");
        if (data.success) {
          output.textContent = "Prediction: " + data.predicted_class;
        } else {
          output.textContent = "Error: " + data.error;
        }
      })
      .catch(err => {
        console.error("Prediction failed:", err);
      });

    }, 3000); // Send every 3 seconds
  }

  document.addEventListener("DOMContentLoaded", function () {
    startCamera();
    startRealTimeDetection();
  });
</script>


  
</body>

</html>
